<!-- Section CTA -->
<section id="cta" class="cta-section" style="text-align:center; padding:50px; background:#f5f5f5;">
    <h2>Rejoignez notre SaaS dès aujourd'hui !</h2>
    <p>Créez un compte et commencez à gérer vos utilisateurs en quelques clics.</p>
    <button id="cta-btn" style="padding:15px 30px; font-size:18px; background:#007BFF; color:white; border:none; border-radius:5px; cursor:pointer;">
        Commencer maintenant
    </button>
</section>

<!-- Modal -->
<div id="cta-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.5); justify-content:center; align-items:center; z-index:1000;">
    <div style="background:white; padding:30px; border-radius:8px; width:90%; max-width:400px; position:relative;">
        <span id="close-modal" style="position:absolute; top:10px; right:15px; cursor:pointer; font-size:20px;">&times;</span>
        <h3>Ajouter un utilisateur</h3>
        <input type="text" id="modal-name" placeholder="Nom" style="width:100%; padding:10px; margin:10px 0;">
        <input type="email" id="modal-email" placeholder="Email" style="width:100%; padding:10px; margin:10px 0;">
        <button id="modal-add-btn" style="width:100%; padding:12px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer;">
            Ajouter
        </button>
        <p id="modal-feedback" style="color:green; margin-top:10px;"></p>
    </div>
</div>

<script>
// Ouvrir le modal
document.getElementById("cta-btn").addEventListener("click", () => {
    document.getElementById("cta-modal").style.display = "flex";
});

// Fermer le modal
document.getElementById("close-modal").addEventListener("click", () => {
    document.getElementById("cta-modal").style.display = "none";
});

// Ajouter un utilisateur depuis le modal
document.getElementById("modal-add-btn").addEventListener("click", async () => {
    const name = document.getElementById("modal-name").value.trim();
    const email = document.getElementById("modal-email").value.trim();
    const feedback = document.getElementById("modal-feedback");
    feedback.textContent = "";

    if(!name || !email){
        feedback.style.color = "red";
        feedback.textContent = "Nom et email requis !";
        return;
    }

    try {
        const response = await fetch("/api/users/add", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({name, email})
        });

        const result = await response.json();

        if(response.ok){
            feedback.style.color = "green";
            feedback.textContent = result.message;
            document.getElementById("modal-name").value = "";
            document.getElementById("modal-email").value = "";
            document.getElementById("cta-modal").style.display = "none";
            // Rafraîchir la table principale
            if(window.loadUsers) loadUsers();
        } else {
            feedback.style.color = "red";
            feedback.textContent = result.error || "Erreur serveur";
        }
    } catch(err){
        console.error("Erreur lors de l'ajout:", err);
        feedback.style.color = "red";
        feedback.textContent = "Erreur serveur";
    }
});

// Fermer le modal en cliquant en dehors
window.addEventListener("click", (e) => {
    const modal = document.getElementById("cta-modal");
    if(e.target === modal) modal.style.display = "none";
});
</script>
